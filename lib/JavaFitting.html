<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.3  (Linux)">
	<META NAME="AUTHOR" CONTENT="Nikolay Kuropatkin">
	<META NAME="CREATED" CONTENT="20080414;16104800">
	<META NAME="CHANGEDBY" CONTENT="Nikolay Kuropatkin">
	<META NAME="CHANGED" CONTENT="20080416;10355000">
	<META NAME="CHANGEDBY" CONTENT="Nikolay Kuropatkin">
	<META NAME="CHANGEDBY" CONTENT="Nikolay Kuropatkin">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<p><img alt="EAG logo" src="eag.png" /></p>
<H1 ALIGN=CENTER>Fitting in Java</H1>
<P ALIGN=CENTER>N. Kuropatkin</P>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">Fitting of a model
function to experimental data is one of the most important scientific
tools.</FONT></P>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">Attempt to Google
search of Java fitting software gives only a few choices. The famous
<A HREF="http://java.freehep.org/freehep-jminuit/project-summary.html" NAME="minuit program">minuit
program</A> is among them. Unfortunately translation of the minuit
package to Java is not complete yet. From the other hand, task of
fitting images of astronomical objects is not very well scaled to the
existing Java minuit implementation. Keeping this in mind I have
ported several minimization algorithms to Java. One of these
algorithms is especially suitable for fitting images. Because these
algorithms have general features it is possible to consider them as a
general use fitting package. The package is named JFuMin, and
contains three fitting classes - JFuMin.java, JLevenMin.java and
JLevenBlockMin.java.</FONT></P>
<H1 ALIGN=CENTER>JFuMin</H1>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">This is an
implementation of the well known least squares minimization algorithm
(Gauss algorithm). It is using linear algebra to calculate and invert
the curvature matrix. I am using <A HREF="http://math.nist.gov/javanumerics/jama/" NAME="Jama">Jama</A>
linear algebra package that I have extended with static methods
permitting to perform matrix operations on double arrays directly,
without creation of Matrix objects. This saves some computational
time. The program uses experimental data presented by ArrayList or
just array of </FONT><FONT SIZE=4 STYLE="font-size: 15pt"><B>Measurement</B></FONT><FONT SIZE=4 STYLE="font-size: 15pt">
objects. See the description of the Measurement class in <A HREF="http://home.fnal.gov/~kuropat/JFuMin/doc/doc/index.html" NAME="Java docs">Java
docs</A>. Fitting parameters are provided as an array (or ArrayList )
of </FONT><FONT SIZE=4 STYLE="font-size: 15pt"><B>UserParameter</B></FONT><FONT SIZE=4 STYLE="font-size: 15pt">
objects. The UserParameter class contains parameter name, parameter
value, maximal step on the parameter, minimal value of the parameter
and maximal value of the parameter. The program uses parameter steps
to restrict big changes of parameters calculated from the
derivatives. This permits to find even not very prominent minimum,
but with somewhat slower convergence. If the step value is set to 0
the parameter is considered as fixed and the minimum search is
performed varying all non fixed parameters. The fitting model is
provided as a user function class. There are two interfaces that
should be implemented by the user function class â€“ </FONT><FONT SIZE=4 STYLE="font-size: 15pt"><B>UserFBase</B></FONT><FONT SIZE=4 STYLE="font-size: 15pt">,
providing just model value at given coordinates and parameter set,
and </FONT><FONT SIZE=4 STYLE="font-size: 15pt"><B>UserFGradientBase</B></FONT><FONT SIZE=4 STYLE="font-size: 15pt">,
providing model value and derivatives on parameters. In the first
case corresponding constructor is using default user function to
calculate derivatives. In the second case user have to provide either
digital or analytical calculation of derivatives. The program works
fine for relatively small amount of the experimental data. When the
number of experimental points groves above several thousands the
memory usage became prohibitive. This is because the program builds
matrices of rank equal to the number of experimental points. Among
other parameters of the constructor are accuracy of the minimum
search and maximal number of iterations after which the program stop
search.</FONT></P>
<P><FONT SIZE=4 STYLE="font-size: 15pt">As usually the fitting
process success depends on the model quality, the choice of the
initial values of parameters, possible correlations between
parameters, and presence of local minima.</FONT></P>
<H1 ALIGN=CENTER>JLevenMin</H1>
<P><FONT SIZE=4 STYLE="font-size: 15pt">This class is an
implementation of the</FONT> <FONT SIZE=4 STYLE="font-size: 15pt"><B>Levenberg-Marquardt</B></FONT>
<FONT SIZE=4 STYLE="font-size: 15pt">method. It has very similar to
JFuMin class interface. There is no limits on the parameter steps in
this method. The step parameter in UserParameter class in this case
is used only to indicate fixed parameters. The program is pretty fast
and can be used to fit big amount of the experimental data. In this
method the program calculates curvature matrix of rank equal to
number of parameters, and is easy on the memory usage.</FONT></P>
<H1 ALIGN=CENTER><FONT SIZE=6 STYLE="font-size: 22pt">JLevenBlockMin</FONT></H1>
<P><FONT SIZE=4 STYLE="font-size: 15pt">There are cases when
calculation for each experimental point of the model value and
derivatives became too expensive, but it is possible to perform
calculation for the whole set of the experimental points at once. In
this case it is reasonable to delegate calculation of all necessary
matrices to user function. This block of calculations is done outside
of the minimization class and is user responsibility. The package
contains an example of such block calculations. This method is very
suitable for fitting a model to an astronomical image when the model
need to be convolved with a PSF image. </FONT>
</P>
<P><BR><BR>
</P>
<H1 ALIGN=CENTER>Package distribution</H1>
<P ALIGN=LEFT> <FONT SIZE=4 STYLE="font-size: 15pt">The package can
be downloaded and installed using the self extracting archive file.
<A HREF="./eag-JFuMin.jar" NAME="eag-JFuMin.jar">Download it from
here.</A>   The file was created using <A HREF="http://izpack.org/" NAME="IzPack">IzPack</A>
package. To install it use following command:</FONT></P>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">java -jar
eag-JFuMin.jar</FONT></P>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">This will open GUI
window. Follow the GUI guide to install the package.</FONT></P>
<P ALIGN=LEFT><BR><BR>
</P>
<P ALIGN=LEFT><FONT SIZE=4 STYLE="font-size: 15pt">After installation you will find a directory with 
documentation and two jar files jamaS.jar and jfumin.jar. The last one contains source files where you
 can find some examples of the package using. To get source files use the command <p>
  jar -xf jfumin.jar </p>
It is recommended to put both jar files in a separate directory (myjars for example) which can be
 used in the classpath.
In java 1.6 one can use wildcard to point to all jar files in the directory.
An example of the compile command would be:<p>
javac -classpath "./myjars/*" gov/fnal/eag/fumin/JLevenMin.java </p>
and execution of the program:<p>
java -classpath "./myjars/*" gov.fnal.eag.fumin.JLevenMin</p>
To run unit tests, providing you have junit.jar file in myjars directory use the command: <p>
 java -classpath "./myjars/*" org.junit.runner.JUnitCore gov.fnal.eag.fumin.test.TestLevenMin
 </p>
</FONT></P>
<P ALIGN=LEFT><BR><BR>
</P>
</BODY>
</HTML>